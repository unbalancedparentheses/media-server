worker_processes 1;

events {
    worker_connections 1024;
}

http {
    proxy_connect_timeout 10s;
    proxy_read_timeout 300s;
    proxy_send_timeout 300s;

    # Jellyfin
    server {
        listen 80;
        server_name jellyfin.media.local;
        client_max_body_size 0;
        location / {
            proxy_pass http://jellyfin:8096;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    }

    # Sonarr
    server {
        listen 80;
        server_name sonarr.media.local;
        location / {
            proxy_pass http://sonarr:8989;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Sonarr Anime
    server {
        listen 80;
        server_name sonarr-anime.media.local;
        location / {
            proxy_pass http://sonarr-anime:8989;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Radarr
    server {
        listen 80;
        server_name radarr.media.local;
        location / {
            proxy_pass http://radarr:7878;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Prowlarr
    server {
        listen 80;
        server_name prowlarr.media.local;
        location / {
            proxy_pass http://prowlarr:9696;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Bazarr
    server {
        listen 80;
        server_name bazarr.media.local;
        location / {
            proxy_pass http://bazarr:6767;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # SABnzbd
    server {
        listen 80;
        server_name sabnzbd.media.local;
        location / {
            proxy_pass http://sabnzbd:8080;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # qBittorrent
    server {
        listen 80;
        server_name qbittorrent.media.local;
        location / {
            proxy_pass http://qbittorrent:8081;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Jellyseerr
    server {
        listen 80;
        server_name jellyseerr.media.local;
        location / {
            proxy_pass http://jellyseerr:5055;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Dashboard (catch-all)
    server {
        listen 80 default_server;
        server_name _;
        location / {
            default_type text/html;
            return 200 '<!DOCTYPE html>
<html>
<head><title>Media Server</title>
<style>
  body { font-family: system-ui; background: #1a1a2e; color: #eee; padding: 2rem; }
  h1 { color: #e94560; }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
  a { display: block; padding: 1.2rem 1.5rem; background: #16213e; border-radius: 8px;
      color: #eee; text-decoration: none; transition: background 0.2s; }
  a:hover { background: #0f3460; }
  .name { font-size: 1.1rem; font-weight: 600; }
  .desc { color: #a0a0b8; font-size: 0.85rem; margin-top: 0.3rem; }
  .port { color: #e94560; font-size: 0.75rem; }
</style></head>
<body>
  <h1>Media Server</h1>
  <div class="grid">
    <a href="http://localhost:5055"><span class="name">Jellyseerr</span><br><span class="desc">Request movies and TV shows</span><br><span class="port">:5055</span></a>
    <a href="http://localhost:8096"><span class="name">Jellyfin</span><br><span class="desc">Watch your media library</span><br><span class="port">:8096</span></a>
    <a href="http://localhost:8989"><span class="name">Sonarr</span><br><span class="desc">TV show management and automation</span><br><span class="port">:8989</span></a>
    <a href="http://localhost:8990"><span class="name">Sonarr Anime</span><br><span class="desc">Anime series management</span><br><span class="port">:8990</span></a>
    <a href="http://localhost:7878"><span class="name">Radarr</span><br><span class="desc">Movie management and automation</span><br><span class="port">:7878</span></a>
    <a href="http://localhost:9696"><span class="name">Prowlarr</span><br><span class="desc">Indexer manager for Sonarr and Radarr</span><br><span class="port">:9696</span></a>
    <a href="http://localhost:6767"><span class="name">Bazarr</span><br><span class="desc">Automatic subtitle downloads</span><br><span class="port">:6767</span></a>
    <a href="http://localhost:8081"><span class="name">qBittorrent</span><br><span class="desc">Torrent download client</span><br><span class="port">:8081</span></a>
    <a href="http://localhost:8080"><span class="name">SABnzbd</span><br><span class="desc">Usenet download client</span><br><span class="port">:8080</span></a>
  </div>
</body></html>';
        }
    }
}

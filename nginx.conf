worker_processes 1;

events {
    worker_connections 1024;
}

http {
    proxy_connect_timeout 10s;
    proxy_read_timeout 300s;
    proxy_send_timeout 300s;

    # Jellyfin
    server {
        listen 80;
        server_name jellyfin.media.local;
        client_max_body_size 0;
        location / {
            proxy_pass http://jellyfin:8096;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    }

    # Sonarr
    server {
        listen 80;
        server_name sonarr.media.local;
        location / {
            proxy_pass http://sonarr:8989;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Sonarr Anime
    server {
        listen 80;
        server_name sonarr-anime.media.local;
        location / {
            proxy_pass http://sonarr-anime:8989;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Radarr
    server {
        listen 80;
        server_name radarr.media.local;
        location / {
            proxy_pass http://radarr:7878;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Prowlarr
    server {
        listen 80;
        server_name prowlarr.media.local;
        location / {
            proxy_pass http://prowlarr:9696;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Bazarr
    server {
        listen 80;
        server_name bazarr.media.local;
        location / {
            proxy_pass http://bazarr:6767;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # SABnzbd
    server {
        listen 80;
        server_name sabnzbd.media.local;
        location / {
            proxy_pass http://sabnzbd:8080;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # qBittorrent
    server {
        listen 80;
        server_name qbittorrent.media.local;
        location / {
            proxy_pass http://qbittorrent:8081;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Jellyseerr
    server {
        listen 80;
        server_name jellyseerr.media.local;
        location / {
            proxy_pass http://jellyseerr:5055;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Dashboard (catch-all)
    server {
        listen 80 default_server;
        server_name _;
        location / {
            default_type text/html;
            return 200 '<!DOCTYPE html>
<html>
<head><title>Media Server</title>
<style>
  body { font-family: system-ui; background: #1a1a2e; color: #eee; padding: 2rem; }
  h1 { color: #e94560; }
  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
  a { display: block; padding: 1.2rem 1.5rem; background: #16213e; border-radius: 8px;
      color: #eee; text-decoration: none; transition: background 0.2s; }
  a:hover { background: #0f3460; }
  .name { font-size: 1.1rem; font-weight: 600; }
  .desc { color: #a0a0b8; font-size: 0.85rem; margin-top: 0.3rem; }
  .port { color: #e94560; font-size: 0.75rem; }
</style></head>
<body>
  <h1>Media Server</h1>
  <div class="grid" id="grid"></div>
  <script>
    var h = location.hostname;
    var s = [
      [5055, \"Jellyseerr\", \"Request movies and TV shows\"],
      [8096, \"Jellyfin\", \"Watch your media library\"],
      [8989, \"Sonarr\", \"TV show management and automation\"],
      [8990, \"Sonarr Anime\", \"Anime series management\"],
      [7878, \"Radarr\", \"Movie management and automation\"],
      [9696, \"Prowlarr\", \"Indexer manager for Sonarr and Radarr\"],
      [6767, \"Bazarr\", \"Automatic subtitle downloads\"],
      [8081, \"qBittorrent\", \"Torrent download client\"],
      [8080, \"SABnzbd\", \"Usenet download client\"]
    ];
    var g = document.getElementById(\"grid\");
    s.forEach(function(x) {
      g.innerHTML += \"<a href=\\\"http://\" + h + \":\" + x[0] + \"\\\"><span class=\\\"name\\\">\" + x[1] + \"</span><br><span class=\\\"desc\\\">\" + x[2] + \"</span><br><span class=\\\"port\\\">:\" + x[0] + \"</span></a>\";
    });
  </script>
</body></html>';
        }
    }
}

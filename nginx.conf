worker_processes 1;

events {
    worker_connections 1024;
}

http {
    proxy_connect_timeout 10s;
    proxy_read_timeout 300s;
    proxy_send_timeout 300s;

    # Jellyfin
    server {
        listen 80;
        server_name jellyfin.media.local;
        client_max_body_size 0;
        location / {
            proxy_pass http://jellyfin:8096;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
        }
    }

    # Sonarr
    server {
        listen 80;
        server_name sonarr.media.local;
        location / {
            proxy_pass http://sonarr:8989;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Sonarr Anime
    server {
        listen 80;
        server_name sonarr-anime.media.local;
        location / {
            proxy_pass http://sonarr-anime:8989;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Radarr
    server {
        listen 80;
        server_name radarr.media.local;
        location / {
            proxy_pass http://radarr:7878;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Prowlarr
    server {
        listen 80;
        server_name prowlarr.media.local;
        location / {
            proxy_pass http://prowlarr:9696;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Bazarr
    server {
        listen 80;
        server_name bazarr.media.local;
        location / {
            proxy_pass http://bazarr:6767;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # SABnzbd
    server {
        listen 80;
        server_name sabnzbd.media.local;
        location / {
            proxy_pass http://sabnzbd:8080;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # qBittorrent
    server {
        listen 80;
        server_name qbittorrent.media.local;
        location / {
            proxy_pass http://qbittorrent:8081;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Jellyseerr
    server {
        listen 80;
        server_name jellyseerr.media.local;
        location / {
            proxy_pass http://jellyseerr:5055;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Organizr
    server {
        listen 80;
        server_name organizr.media.local;
        location / {
            proxy_pass http://organizr:80;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Dashboard (catch-all)
    server {
        listen 80 default_server;
        server_name _;
        location / {
            default_type text/html;
            return 200 '<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Media Server</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:system-ui,-apple-system,sans-serif;background:#0f0f1a;color:#e0e0e0;min-height:100vh}
  .header{background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);padding:2rem 2rem 1.5rem;border-bottom:1px solid #2a2a4a}
  .header h1{font-size:1.6rem;font-weight:700;letter-spacing:-0.02em}
  .header h1 span{color:#e94560}
  .header p{color:#7a7a9a;font-size:0.85rem;margin-top:0.3rem}
  .content{max-width:1200px;margin:0 auto;padding:1.5rem 2rem 3rem}
  .section{margin-bottom:2rem}
  .section-title{font-size:0.7rem;font-weight:600;text-transform:uppercase;letter-spacing:0.1em;color:#7a7a9a;margin-bottom:0.75rem;padding-left:0.25rem}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:0.75rem}
  .card{display:flex;align-items:center;gap:1rem;padding:1rem 1.2rem;background:#1a1a2e;border:1px solid #2a2a4a;border-radius:10px;color:#e0e0e0;text-decoration:none;transition:all 0.2s ease}
  .card:hover{background:#1e2240;border-color:#3a3a5a;transform:translateY(-1px)}
  .icon{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;flex-shrink:0}
  .card-info{flex:1;min-width:0}
  .card-name{font-size:0.95rem;font-weight:600}
  .card-desc{font-size:0.75rem;color:#7a7a9a;margin-top:0.15rem}
  .card-port{font-size:0.65rem;color:#e94560;font-weight:500;margin-top:0.2rem}
  .dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;background:#3a3a5a}
  .dot.up{background:#4ade80}
  .cat-media .icon{background:#e9456020;color:#e94560}
  .cat-manage .icon{background:#3b82f620;color:#3b82f6}
  .cat-download .icon{background:#f59e0b20;color:#f59e0b}
  .cat-tools .icon{background:#8b5cf620;color:#8b5cf6}
</style></head>
<body>
  <div class="header"><h1><span>Media</span> Server</h1><p>Service dashboard</p></div>
  <div class="content" id="app"></div>
  <script>
    var h=location.hostname;
    var sections=[
      [\"Watch & Request\",\"cat-media\",[
        [5055,\"Jellyseerr\",\"Request movies & TV\",\"cat-media\"],
        [8096,\"Jellyfin\",\"Stream your library\",\"cat-media\"]
      ]],
      [\"Library Management\",\"cat-manage\",[
        [8989,\"Sonarr\",\"TV show automation\",\"cat-manage\"],
        [8990,\"Sonarr Anime\",\"Anime series\",\"cat-manage\"],
        [7878,\"Radarr\",\"Movie automation\",\"cat-manage\"],
        [9696,\"Prowlarr\",\"Indexer management\",\"cat-manage\"],
        [6767,\"Bazarr\",\"Subtitle downloads\",\"cat-manage\"]
      ]],
      [\"Downloads\",\"cat-download\",[
        [8081,\"qBittorrent\",\"Torrent client\",\"cat-download\"],
        [8080,\"SABnzbd\",\"Usenet client\",\"cat-download\"]
      ]],
      [\"Tools\",\"cat-tools\",[
        [9090,\"Organizr\",\"Unified dashboard\",\"cat-tools\"]
      ]]
    ];
    var app=document.getElementById(\"app\");
    sections.forEach(function(sec){
      var html=\"<div class=\\\"section\\\"><div class=\\\"section-title\\\">\"+sec[0]+\"</div><div class=\\\"grid\\\">\";
      sec[2].forEach(function(s){
        var id=\"s\"+s[0];
        html+=\"<a href=\\\"http://\"+h+\":\"+s[0]+\"\\\" class=\\\"card \"+s[3]+\"\\\" id=\\\"\"+id+\"\\\"><div class=\\\"icon\\\">&#9679;</div><div class=\\\"card-info\\\"><div class=\\\"card-name\\\">\"+s[1]+\"</div><div class=\\\"card-desc\\\">\"+s[2]+\"</div><div class=\\\"card-port\\\">:\"+s[0]+\"</div></div><div class=\\\"dot\\\" id=\\\"d\"+s[0]+\"\\\"></div></a>\";
      });
      html+=\"</div></div>\";
      app.innerHTML+=html;
    });
    sections.forEach(function(sec){
      sec[2].forEach(function(s){
        var d=document.getElementById(\"d\"+s[0]);
        fetch(\"http://\"+h+\":\"+s[0],{mode:\"no-cors\",signal:AbortSignal.timeout(3000)}).then(function(){d.classList.add(\"up\")}).catch(function(){});
      });
    });
  </script>
</body></html>';
        }
    }
}
